<div ng-controller="RosterCtrl" layout="column" flex>
	<md-content>
		<div layout="column" layout-gt-md="row" class="content-wrap">
			<section flex>
				<div ng-repeat="timegroup in timegroups" ng-show="timegroup.$id === 'upcoming' || (timegroup.$events | length)">
					<md-subheader class="md-no-sticky">
						<div layout="row">
							<span flex ng-bind="timegroup.name"></span>
						</div>
					</md-subheader>
					<md-card>
						<md-list>
							<md-list-item ng-repeat="event in timegroup.$events = (events | filterByTimegroup:timegroup.$id | orderBy:timegroup.orderBy)" ng-click="$state.go('event', {roster: roster.$id, event: event.$id})" ng-class="{previous: $state.$previous.params.roster === roster.$id && $state.$previous.params.event === event.$id}">
								<figure class="md-avatar calendar-day md-primary">
									<div class="month" ng-bind="event.date | date:'MMM'"></div>
									<div class="day" ng-bind="event.date | date:'d'"></div>
								</figure>
								<figure class="md-avatar calendar-day md-accent">
									<div class="hour" ng-bind="event.date | date:'h:mm'"></div>
									<div class="ampm" ng-bind="event.date | date:'a'"></div>
								</figure>
								
								<p>{{ event.name }}</p>
								
								<rsvp event="$firebaseHelper.object(events, event.$id)" participant="$me" ng-click="$event.stopPropagation()"></rsvp>
							</md-list-item>
							<md-list-item ng-if=" ! (events | length)" class="no-results">
								No events found.
							</md-list-item>
						</md-list>
					</md-card>
				</div>
			</section>
			<section>
				<div>
					<md-subheader class="md-no-sticky">
						<div layout="row">
							<span flex>Participants</span>
							
							<span class="counter">
								<md-icon md-font-set="fa" class="fa-venus"></md-icon> {{ participants | gender:'female' | length }}
							</span>
							<span class="counter">
								<md-icon md-font-set="fa" class="fa-mars"></md-icon> {{ participants | gender:'male' | length }}
							</span>
							<span class="counter">
								<md-icon>people</md-icon> {{ participants | length }}
							</span>
						</div>
					</md-subheader>
					<md-card>
						<md-list>
							<md-list-item ng-repeat="participant in participants | orderBy:'name'">
								<img ng-src="{{ avatar(participant.facebook.id) }}" width="32" height="32" class="md-avatar" alt="{{ participant.name }}" />
								
								<p>{{ participant.name }}</p>
								<div ng-if="canEdit(undefined, roster.admins)">
									<md-button ng-click="removeUser($event.shiftKey, participant)" class="md-icon-button md-warn" aria-label="Remove participant">
										<md-icon>close</md-icon>
									</md-button>
								</div>
							</md-list-item>
							<md-list-item ng-if=" ! (participants | length)" class="no-results">
								No participants found.
							</md-list-item>
						</md-list>
					</md-card>
				</div>
				<div ng-if="invites.length">
					<md-subheader class="md-no-sticky">Invitees</md-subheader>
					<md-card>
						<md-list>
							<md-list-item ng-repeat="participant in invites | orderBy:'name'">
								<img ng-src="{{ avatar(participant.facebook.id) }}" width="32" height="32" class="md-avatar" alt="{{ participant.name }}" />
								
								<p>{{ participant.name || participant.email }}</p>
								<div ng-if="canEdit(undefined, roster.admins)">
									<md-button ng-click="rescindInvite($event.shiftKey, participant)" class="md-icon-button md-warn" aria-label="Rescind invite">
										<md-icon>close</md-icon>
									</md-button>
								</div>
							</md-list-item>
						</md-list>
					</md-card>
				</div>
			</section>
		</div>
	</md-content>
	
	<md-fab-speed-dial ng-if="canEdit(undefined, roster.admins)" md-direction="up" class="md-scale md-fab-speed-dial-bottom-right">
		<md-fab-trigger>
			<div layout="row">
				<label><div>Add new event</div></label>
				<md-button ng-click="newEvent()" class="md-fab" aria-label="Add new event">
					<md-icon>add</md-icon>
				</md-button>
			</div>
		</md-fab-trigger>
		<md-fab-actions>
			<div layout="row">
				<label><div>Edit roster</div></label>
				<md-button ng-click="editRoster()" class="md-fab md-mini md-raised md-primary" aria-label="Edit roster">
					<md-icon>create</md-icon>
				</md-button>
			</div>
			<div layout="row">
				<label><div>Delete roster</div></label>
				<md-button ng-click="deleteRoster($event.shiftKey)" class="md-fab md-mini md-raised md-warn" aria-label="Delete roster">
					<md-icon>delete</md-icon>
				</md-button>
			</div>
<!--
			<div layout="row">
				<label><div>Add user</div></label>
				<md-button ng-click="addUser()" class="md-fab md-mini md-raised md-accent" aria-label="Add user">
					<md-icon>person_add</md-icon>
				</md-button>
			</div>
-->
			<div layout="row">
				<label><div>Invite new user</div></label>
				<md-button ng-click="inviteUser()" class="md-fab md-mini md-raised md-accent" aria-label="Invite new user">
					<md-icon>person_add</md-icon>
				</md-button>
			</div>
		</md-fab-actions>
	</md-fab-speed-dial>
</div>