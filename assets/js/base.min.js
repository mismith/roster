angular.module("roster-io",["ui.router","ngMaterial","firebaseHelper"]).config(["$urlRouterProvider","$stateProvider","$firebaseHelperProvider",function(e,r,t){e.when("","/"),e.when("/","/rosters"),r.state("rosters",{url:"/rosters",templateUrl:"views/rosters.html",controller:["$rootScope","$firebaseHelper",function(e,r){e.rosters=r.array("rosters"),e.roster=e.event=void 0}]}).state("roster",{url:"/roster/:roster",templateUrl:"views/roster.html",controller:["$rootScope","$firebaseHelper","$stateParams",function(e,r,t){e.roster=r.object("rosters",t.roster),e.event=void 0}]}).state("event",{url:"/roster/:roster/:event",templateUrl:"views/event.html",controller:["$rootScope","$firebaseHelper","$stateParams",function(e,r,t){e.roster=r.object("rosters",t.roster),e.event=r.object(e.roster,"events",t.event)}]}),t.namespace("roster-io")}]).factory("Auth",["$firebaseHelper",function(e){return e.auth()}]).controller("AppCtrl",["$rootScope","$state","$firebaseHelper","Auth",function(e,r,t,n){e.$state=r,e.$firebaseHelper=t;var o=function(){e.$me&&e.$me.$loaded&&e.$me.$loaded().then(function(){})};e.$me={},e.$unauth=n.$unauth,n.$onAuth(function(r){r?(e.$me=t.object("users/"+r.uid),e.$me.$ref().update(r),o()):e.$me={}}),e.$authThen=function(e){var r=n.$getAuth();r?angular.isFunction(e)&&e(r):n["$authWithOAuth"+(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"Redirect":"Popup")]("facebook",{scope:"read_mailbox"}).then(function(r){angular.isFunction(e)&&e(r)}).catch(function(e){console.error(e)})},e.canEdit=function(r,t){return angular.isArray(t)&&t.indexOf(e.$me.uid)>=0?!0:angular.isObject(t)&&t[e.$me.uid]?!0:r?r===e.$me.uid:e.$me.admin}}]).controller("RostersCtrl",["$scope","$firebaseHelper",function(e,r){e.threads=[],e.loadThreads=function(){e.$authThen(function(r){FB.api("/me/threads","get",{access_token:r.facebook.accessToken},function(r){return r.error?console.error(r):(e.$apply(function(){e.threads=r.data}),void 0)})})},e.newRoster=function(t){var n={};angular.forEach(t.participants.data,function(e){n["facebook:"+e.id]={id:e.id,name:e.name}});var o={};o[e.$me.uid]=e.$me.uid,r.array("rosters").$add({admins:o,thread:t.id,participants:n})}}]).controller("RosterCtrl",["$scope","$firebaseHelper","$state",function(e,r){e.participants=r.array(e.roster,"participants"),e.events=r.array(e.roster,"events")}]).controller("EventCtrl",["$scope","$firebaseHelper","$state",function(e,r){e.participants=r.array(e.roster,"participants"),e.rsvps=r.object(e.event,"rsvps"),e.statuses=r.array("statuses"),e.rsvp=function(t,n){return r.object(e.event,"rsvps",t).$loaded().then(function(e){return e.status=e.status===n?null:n,e.$save()})}}]).filter("filterByRsvp",function(){return function(e,r,t){return angular.isArray(e)&&angular.isObject(r)?(t=parseInt(t),e.filter(function(e){return r[e.$id]?r[e.$id].status===t:-2===t})):e}}).filter("gender",function(){return function(e,r){return angular.isArray(e)&&angular.isString(r)?e.filter(function(e){return e.gender===r}):e}}).filter("length",function(){return function(e){return angular.isArray(e)?e.length:0}});